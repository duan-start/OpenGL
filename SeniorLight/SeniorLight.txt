首先我们要明白opengl 的渲染好像都是基于phong ，而不是解具体的渲染方程（也可能是我的能力不够）

由于blinphone 模型，所以我们直接在这里开始高级光照的设计

blinnPhong  的着色模型
由于phone 模型，视线和反射光的夹角（可能会大于90度，视角和光源在同一侧）
为了更精准的计算这些diffuse ,我们即将利用是的是半程向量。
通过半程向量和法向向量的点击，我们能够保证一侧一定是真的。
halfwayDir 的计算
当然这是再高光层面上的改进

》》》gamma 校正
由于人眼对强度较高的光是不敏感的，所以我们需要。
即光强要double 变化，才能感受到相同的变化，及变化不是人眼所感觉的线性的。（这个只要设计师知道对应的原理就好了）
显示器是非线性变化的，但是我们不能要（实际上我们要的应该是2^x，而不是x^2），这会导致，实际显示光照的不可控。所一我们需要在最后绘制颜色之前，做一个gamma校正，来使其经过处理后能回到我们预设的光照值
当然是在片段着色器中进行改变了。//一定等所有的颜色都设置好
或者就是用这个了：
glEnable(GL_FRAMEBUFFER_SRGB);//不用fragment 做处理

通用下：有颜色的贴图都是srgb 的存储格式（也就是说已经进行了gamma校正，所以我们转换数据的时候，一般使用srgb 的格式读的，这样的话我们就可以直接在线性空间中操作了，然后我们通过glEnable(GL_FRAMEBUFFER_SRGB)这个函数保证最后输出的时候能进行gamma校正）

虽然从数学上看，伽马校正和显示器的非线性显示似乎会抵消，但实际上，衰减公式改变了颜色值的分布，导致最终显示的颜色与原始线性颜色不同。因此，伽马校正和显示器的非线性特性并不会完全抵消，而是共同作用，确保最终显示效果符合预期。
所以在有gamma校正的时候，我们是使用正常的平方衰减。
没有gamma校正的时候，我们使用的是线性的衰减


》》》法线贴图。
实际上是将法线如何正确的贴到我们的纹理中，
为了实现这个目标，我们必须找一个中间的空间坐标系。
对纹理来讲。我们计算出他的一个相对的切线空间。
这个切线空间实际上就是法线坐标的标准坐标系。
我们通过逆变换，就能够直接将法线的方向转为现实空间的对应的位置。然后就直接贴接好了。

存储法线贴图：
法线贴图中的每个像素存储的是相对于切线空间的法线方向，而不是世界空间或模型空间的法线方向。
这些法线方向通常被编码为 RGB 值，其中 R、G 和 B 分别对应切线空间中的 x、y 和 z 分量。//切线空间


//
在进行色调映射（Tone Mapping）和 Gamma 校正后，颜色之间的相对关系和视觉感知会尽可能接近原始 HDR 图像，但**无法保证完全一致**。这是因为 HDR 图像的动态范围远大于标准显示器能够显示的范围，因此需要通过映射和校正来适配显示器的显示能力。这个过程中不可避免地会有一些信息丢失或变化。

### **1. **色调映射（Tone Mapping）的效果**
色调映射的目的是将 HDR 图像（具有高动态范围）压缩到适合显示器显示的范围（通常是 [0, 1]）。这个过程会改变颜色的绝对值，但会尽量保持颜色之间的相对关系和视觉感知。例如：
- **曝光控制**：通过调整 `exposure` 参数，可以控制图像的整体亮度。
- **色调映射算法**：不同的色调映射算法（如 Reinhard、Filmic 等）会以不同的方式压缩动态范围，但目标都是尽量保持视觉上的自然感。

### **2. Gamma 校正的效果**
Gamma 校正的目的是调整颜色值以适配显示器的非线性响应特性。显示器通常以 Gamma 曲线显示颜色，因此需要对颜色值进行 Gamma 校正，以确保最终显示的图像看起来正确。Gamma 校正会改变颜色值，但会保持颜色之间的相对亮度关系。

### **3. 颜色之间的组合是否一致？**
虽然色调映射和 Gamma 校正会改变颜色值，但它们的目标是保持颜色之间的相对关系和视觉感知。具体来说：
- **相对亮度**：色调映射会尽量保持颜色之间的相对亮度关系。例如，较亮的颜色仍然会比其他颜色更亮。
- **颜色对比度**：虽然颜色值会被压缩，但色调映射算法会尽量保持颜色对比度，使得图像看起来自然。
- **Gamma 校正**：通过调整颜色值以适配显示器的 Gamma 曲线，Gamma 校正会保持颜色之间的相对关系。

### **4. 无法保证完全一致的原因**
尽管色调映射和 Gamma 校正的目标是保持颜色之间的相对关系，但以下因素可能导致无法完全一致：
- **信息丢失**：HDR 图像的动态范围远大于显示器能够显示的范围，因此在压缩过程中会丢失一些信息。
- **色调映射算法的选择**：不同的色调映射算法会以不同的方式处理颜色值，因此选择合适的算法很重要。
- **显示器的限制**：标准显示器的动态范围有限，无法完全显示 HDR 图像的所有细节。

### **5. 总结**
虽然色调映射和 Gamma 校正会改变颜色值，但它们的目标是保持颜色之间的相对关系和视觉感知。虽然无法保证完全一致，但通过选择合适的色调映射算法和调整参数，可以尽量保持图像的自然感和视觉效果。
//
